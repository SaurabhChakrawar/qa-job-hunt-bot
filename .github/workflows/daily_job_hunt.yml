name: ğŸ¤– Daily QA Job Hunt

on:
  schedule:
    - cron: '30 3 * * *'   # 9:00 AM IST (3:30 AM UTC) every day
  workflow_dispatch:         # Also allows manual trigger from GitHub UI (for testing)

jobs:
  job-hunt:
    runs-on: ubuntu-latest
    timeout-minutes: 45      # Stop if something hangs

    steps:

      # â”€â”€ Step 1: Get your code â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      # â”€â”€ Step 2: Setup Python â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'        # Caches pip packages â€” makes runs faster

      # â”€â”€ Step 3: Install dependencies â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ“¦ Install Python packages
        run: pip install -r requirements.txt

      # â”€â”€ Step 4: Install Playwright browser â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸŒ Install Playwright Chromium
        run: playwright install chromium --with-deps

      # â”€â”€ Step 5: Create config from GitHub Secrets â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: âš™ï¸ Create config.json from secrets
        run: |
          mkdir -p config
          cat > config/config.json << EOF
          {
            "api_keys": {
              "gemini_api_key": "${{ secrets.GEMINI_API_KEY }}",
              "apify_api_key": ""
            },
            "email": {
              "sender_email": "${{ secrets.GMAIL_ADDRESS }}",
              "sender_app_password": "${{ secrets.GMAIL_APP_PASSWORD }}",
              "recipient_email": "${{ secrets.GMAIL_ADDRESS }}",
              "report_time_ist": "09:00"
            },
            "linkedin": {
              "email": "${{ secrets.LINKEDIN_EMAIL }}",
              "password": "${{ secrets.LINKEDIN_PASSWORD }}",
              "auto_apply": false,
              "max_apply_per_day": 0
            },
            "job_preferences": {
              "role_titles": [
                "QA Automation Engineer",
                "Software Test Engineer",
                "SDET",
                "Test Automation Engineer",
                "QA Engineer",
                "Quality Assurance Engineer",
                "Automation Test Lead",
                "Senior QA Engineer"
              ],
              "experience_years": 3,
              "min_match_score": 60,
              "excluded_keywords": ["unpaid", "internship", "fresher only"],
              "preferred_salary_usd_min": 30000
            },
            "search_settings": {
              "max_jobs_per_source": 30,
              "days_old_max": 3,
              "dedup_window_days": 30
            }
          }
          EOF

      # â”€â”€ Step 6: Create resume profile from secret â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ“„ Create resume profile
        run: |
          mkdir -p config
          echo '${{ secrets.RESUME_PROFILE_JSON }}' > config/resume_profile.json

      # â”€â”€ Step 7: Create required folders â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ“ Create folders
        run: mkdir -p logs data

      # â”€â”€ Step 8: Run the job hunt bot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸš€ Run Job Hunt Pipeline
        run: python main.py
        env:
          PYTHONUNBUFFERED: 1   # Shows logs in real time

      # â”€â”€ Step 9: Upload report as artifact â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ“Š Upload report artifact
        if: always()            # Upload even if there was an error
        uses: actions/upload-artifact@v4
        with:
          name: job-report-${{ github.run_number }}
          path: logs/report_*.html
          retention-days: 30    # Keep reports for 30 days
