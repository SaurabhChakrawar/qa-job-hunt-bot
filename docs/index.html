<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QA Job Hunt Dashboard</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: #f1f5f9; color: #1f2937; }
.header { background: linear-gradient(135deg, #1e40af, #6d28d9); color: #fff; padding: 24px 20px; }
.header-inner { max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px; }
.header h1 { font-size: 22px; font-weight: 800; }
.header p { font-size: 13px; opacity: 0.8; margin-top: 2px; }
.last-updated { font-size: 12px; background: rgba(255,255,255,0.15); padding: 6px 14px; border-radius: 20px; }
.stats { max-width: 1200px; margin: 20px auto; padding: 0 16px; display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 12px; }
.stat { background: #fff; border-radius: 14px; padding: 16px; text-align: center; box-shadow: 0 1px 3px rgba(0,0,0,0.07); }
.stat-num { font-size: 32px; font-weight: 800; }
.stat-label { font-size: 11px; color: #6b7280; font-weight: 600; text-transform: uppercase; margin-top: 4px; }
.filters { max-width: 1200px; margin: 0 auto 16px; padding: 0 16px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
.search-box { flex: 1; min-width: 200px; padding: 10px 16px; border: 1px solid #e5e7eb; border-radius: 10px; font-size: 14px; outline: none; }
.search-box:focus { border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }
.filter-btn { padding: 9px 16px; border: 1px solid #e5e7eb; border-radius: 10px; font-size: 13px; font-weight: 600; background: #fff; cursor: pointer; transition: all 0.15s; white-space: nowrap; }
.filter-btn:hover { background: #f3f4f6; }
.filter-btn.active { background: #2563eb; color: #fff; border-color: #2563eb; }
.sort-select { padding: 9px 14px; border: 1px solid #e5e7eb; border-radius: 10px; font-size: 13px; background: #fff; cursor: pointer; outline: none; }
.jobs-container { max-width: 1200px; margin: 0 auto; padding: 0 16px 40px; }
.jobs-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 16px; }
.job-card { background: #fff; border-radius: 16px; padding: 20px; box-shadow: 0 1px 4px rgba(0,0,0,0.07); border: 1px solid #e5e7eb; transition: transform 0.15s, box-shadow 0.15s; display: flex; flex-direction: column; }
.job-card:hover { transform: translateY(-2px); box-shadow: 0 4px 16px rgba(0,0,0,0.1); }
.card-top { display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; }
.job-title { font-size: 15px; font-weight: 700; color: #1d4ed8; text-decoration: none; line-height: 1.3; flex: 1; }
.job-title:hover { text-decoration: underline; }
.score-badge { flex-shrink: 0; border-radius: 10px; padding: 6px 10px; text-align: center; min-width: 56px; }
.score-num { font-size: 18px; font-weight: 800; line-height: 1; }
.score-label { font-size: 10px; font-weight: 600; }
.score-excellent { background: #f0fdf4; color: #16a34a; }
.score-good { background: #fffbeb; color: #d97706; }
.score-fair { background: #f9fafb; color: #6b7280; }
.company-info { margin-top: 8px; font-size: 13px; color: #6b7280; display: flex; flex-wrap: wrap; gap: 6px; align-items: center; }
.company-name { font-weight: 600; color: #374151; }
.badges { margin-top: 10px; display: flex; flex-wrap: wrap; gap: 5px; }
.badge { display: inline-block; padding: 3px 9px; border-radius: 20px; font-size: 11px; font-weight: 700; }
.badge-remote { background: #ede9fe; color: #6d28d9; }
.badge-india { background: #dbeafe; color: #1d4ed8; }
.badge-sponsor { background: #dcfce7; color: #166534; }
.badge-source { background: #f3f4f6; color: #6b7280; }
.match-section { margin-top: 12px; flex: 1; }
.match-title { font-size: 11px; font-weight: 700; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px; }
.match-list { list-style: none; }
.match-list li { font-size: 12px; color: #374151; padding: 2px 0; }
.card-footer { margin-top: 14px; padding-top: 14px; border-top: 1px solid #f3f4f6; display: flex; gap: 8px; align-items: center; }
.apply-btn { flex: 1; display: block; background: #1d4ed8; color: #fff; text-align: center; padding: 9px 16px; border-radius: 8px; font-size: 13px; font-weight: 700; text-decoration: none; transition: background 0.15s; }
.apply-btn:hover { background: #1e3a8a; }
.save-btn { padding: 9px 14px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 13px; cursor: pointer; background: #fff; color: #374151; transition: all 0.15s; }
.save-btn:hover { background: #fef3c7; border-color: #fcd34d; }
.save-btn.saved { background: #fef3c7; border-color: #f59e0b; color: #d97706; }
.results-bar { max-width: 1200px; margin: 0 auto 12px; padding: 0 16px; }
.results-count { font-size: 14px; color: #6b7280; }
.saved-panel { position: fixed; bottom: 20px; right: 20px; background: #1d4ed8; color: #fff; padding: 12px 20px; border-radius: 50px; font-size: 13px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(29,78,216,0.4); display: none; z-index: 100; }
.empty { text-align: center; padding: 80px 20px; }
.empty-icon { font-size: 60px; margin-bottom: 16px; }
.empty h2 { font-size: 20px; color: #374151; margin-bottom: 8px; }
.empty p { color: #9ca3af; font-size: 14px; }
.loading { text-align: center; padding: 80px; }
.spinner { width: 40px; height: 40px; border: 4px solid #e5e7eb; border-top-color: #2563eb; border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 16px; }
@keyframes spin { to { transform: rotate(360deg); } }
@media (max-width: 600px) { .jobs-grid { grid-template-columns: 1fr; } .header h1 { font-size: 18px; } }

/* PIN */
.pin-overlay { position: fixed; inset: 0; background: linear-gradient(135deg, #1e40af, #6d28d9); display: flex; align-items: center; justify-content: center; z-index: 9999; }
.pin-box { background: #fff; border-radius: 24px; padding: 40px 36px; text-align: center; width: 340px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
.pin-icon { font-size: 48px; margin-bottom: 12px; }
.pin-title { font-size: 22px; font-weight: 800; color: #1f2937; margin-bottom: 4px; }
.pin-subtitle { font-size: 13px; color: #9ca3af; margin-bottom: 28px; }
.pin-dots { display: flex; justify-content: center; gap: 14px; margin-bottom: 28px; }
.pin-dot { width: 16px; height: 16px; border-radius: 50%; background: #e5e7eb; transition: all 0.2s; }
.pin-dot.filled { background: #1d4ed8; transform: scale(1.1); }
.pin-dot.error { background: #ef4444; }
.pin-keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
.pin-key { background: #f8fafc; border: 1px solid #e5e7eb; border-radius: 14px; padding: 18px; font-size: 20px; font-weight: 700; cursor: pointer; transition: all 0.15s; color: #1f2937; }
.pin-key:hover { background: #eff6ff; border-color: #93c5fd; color: #1d4ed8; }
.pin-key:active { transform: scale(0.95); background: #dbeafe; }
.pin-key.del { font-size: 16px; color: #6b7280; }
.pin-error { color: #ef4444; font-size: 13px; font-weight: 600; margin-top: 16px; min-height: 20px; }
.pin-hint { font-size: 11px; color: #d1d5db; margin-top: 16px; }
</style>
</head>
<body>

<!-- PIN Overlay ‚Äî MUST be first in body -->
<div class="pin-overlay" id="pin-overlay">
  <div class="pin-box">
    <div class="pin-icon">üîê</div>
    <div class="pin-title">Job Hunt Dashboard</div>
    <div class="pin-subtitle">Enter your 4-digit PIN</div>
    <div class="pin-dots">
      <div class="pin-dot" id="dot-0"></div>
      <div class="pin-dot" id="dot-1"></div>
      <div class="pin-dot" id="dot-2"></div>
      <div class="pin-dot" id="dot-3"></div>
    </div>
    <div class="pin-keypad">
      <button class="pin-key" onclick="pinPress('1')">1</button>
      <button class="pin-key" onclick="pinPress('2')">2</button>
      <button class="pin-key" onclick="pinPress('3')">3</button>
      <button class="pin-key" onclick="pinPress('4')">4</button>
      <button class="pin-key" onclick="pinPress('5')">5</button>
      <button class="pin-key" onclick="pinPress('6')">6</button>
      <button class="pin-key" onclick="pinPress('7')">7</button>
      <button class="pin-key" onclick="pinPress('8')">8</button>
      <button class="pin-key" onclick="pinPress('9')">9</button>
      <button class="pin-key" onclick="pinPress('')"></button>
      <button class="pin-key" onclick="pinPress('0')">0</button>
      <button class="pin-key del" onclick="pinDelete()">‚å´</button>
    </div>
    <div class="pin-error" id="pin-error"></div>
    <div class="pin-hint">Hint: last 4 digits of your phone</div>
  </div>
</div>

<!-- Header -->
<div class="header">
  <div class="header-inner">
    <div>
      <h1>ü§ñ QA Job Hunt Dashboard</h1>
      <p id="subtitle">Loading your daily job matches...</p>
    </div>
    <div class="last-updated" id="last-updated">‚Äî</div>
  </div>
</div>

<!-- Stats -->
<div class="stats">
  <div class="stat"><div class="stat-num" id="stat-total" style="color:#2563eb">‚Äî</div><div class="stat-label">Total Jobs</div></div>
  <div class="stat"><div class="stat-num" id="stat-excellent" style="color:#16a34a">‚Äî</div><div class="stat-label">Excellent 80%+</div></div>
  <div class="stat"><div class="stat-num" id="stat-good" style="color:#d97706">‚Äî</div><div class="stat-label">Good 60-79%</div></div>
  <div class="stat"><div class="stat-num" id="stat-india" style="color:#7c3aed">‚Äî</div><div class="stat-label">India Remote</div></div>
  <div class="stat"><div class="stat-num" id="stat-sponsor" style="color:#059669">‚Äî</div><div class="stat-label">Sponsorship</div></div>
</div>

<!-- Filters -->
<div class="filters">
  <input class="search-box" id="search" type="text" placeholder="üîç Search by title, company, skill...">
  <button class="filter-btn active" onclick="setFilter('all', this)">All Jobs</button>
  <button class="filter-btn" onclick="setFilter('india_remote', this)">üáÆüá≥ India Remote</button>
  <button class="filter-btn" onclick="setFilter('remote_worldwide', this)">üåç Remote Worldwide</button>
  <button class="filter-btn" onclick="setFilter('sponsorship_worldwide', this)">‚úàÔ∏è Sponsorship</button>
  <select class="sort-select" id="sort-select" onchange="renderJobs()">
    <option value="score">Sort: Best Match</option>
    <option value="date">Sort: Newest</option>
    <option value="company">Sort: Company A-Z</option>
  </select>
</div>

<div class="results-bar">
  <div class="results-count" id="results-count"></div>
</div>

<div class="jobs-container">
  <div id="loading" class="loading" style="display:none">
    <div class="spinner"></div>
    <p style="color:#6b7280">Loading your job matches...</p>
  </div>
  <div class="jobs-grid" id="jobs-grid" style="display:none"></div>
  <div id="no-jobs" style="display:none">
    <div class="empty"><div class="empty-icon">üîç</div><h2>No jobs match</h2><p>Try a different filter or search</p></div>
  </div>
</div>

<div class="saved-panel" id="saved-panel" onclick="showSaved()">‚≠ê <span id="saved-count">0</span> Saved</div>

<script>
let allJobs = [];
let currentFilter = 'all';
let savedJobs = JSON.parse(localStorage.getItem('savedQAJobs') || '[]');

function decodeHTML(str) {
  if (!str) return '';
  const txt = document.createElement('textarea');
  txt.innerHTML = str;
  return txt.value;
}

async function loadJobs() {
  document.getElementById('loading').style.display = 'block';
  try {
    const resp = await fetch('jobs.json?t=' + Date.now());
    if (!resp.ok) throw new Error('Not found');
    const data = await resp.json();
    allJobs = data.jobs || [];
    document.getElementById('last-updated').textContent = 'üïê ' + (data.generated_at ? new Date(data.generated_at).toLocaleString('en-IN', {timeZone:'Asia/Kolkata'}) + ' IST' : 'Today');
    document.getElementById('subtitle').textContent = `${allJobs.length} jobs matched ‚Ä¢ QA Automation Engineer ‚Ä¢ Worldwide`;
    updateStats();
    renderJobs();
    document.getElementById('loading').style.display = 'none';
  } catch(e) {
    document.getElementById('loading').innerHTML = '<div class="empty"><div class="empty-icon">üì≠</div><h2>No job data yet</h2><p>Run the workflow first, then refresh.</p></div>';
  }
}

function updateStats() {
  document.getElementById('stat-total').textContent = allJobs.length;
  document.getElementById('stat-excellent').textContent = allJobs.filter(j => j.match_score >= 80).length;
  document.getElementById('stat-good').textContent = allJobs.filter(j => j.match_score >= 60 && j.match_score < 80).length;
  document.getElementById('stat-india').textContent = allJobs.filter(j => j.category === 'india_remote').length;
  document.getElementById('stat-sponsor').textContent = allJobs.filter(j => j.category === 'sponsorship_worldwide').length;
}

function setFilter(f, btn) {
  currentFilter = f;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderJobs();
}

function renderJobs() {
  const query = document.getElementById('search').value.toLowerCase();
  const sort = document.getElementById('sort-select').value;
  let jobs = allJobs.filter(j => {
    const mf = currentFilter === 'all' || j.category === currentFilter;
    const ms = !query || (j.title||'').toLowerCase().includes(query) || (j.company||'').toLowerCase().includes(query) || (j.match_reasons||[]).join(' ').toLowerCase().includes(query);
    return mf && ms;
  });
  if (sort === 'score') jobs.sort((a,b) => (b.match_score||0)-(a.match_score||0));
  else if (sort === 'date') jobs.sort((a,b) => (b.date_posted||'').localeCompare(a.date_posted||''));
  else if (sort === 'company') jobs.sort((a,b) => (a.company||'').localeCompare(b.company||''));

  document.getElementById('results-count').textContent = `${jobs.length} jobs found`;
  const grid = document.getElementById('jobs-grid');
  const noJobs = document.getElementById('no-jobs');
  if (jobs.length === 0) { grid.style.display='none'; noJobs.style.display='block'; }
  else { noJobs.style.display='none'; grid.style.display='grid'; grid.innerHTML = jobs.map(buildCard).join(''); }
  updateSavedPanel();
}

function buildCard(job) {
  const score = job.match_score || 0;
  const isSaved = savedJobs.includes(job.id);
  const sc = score>=80?'score-excellent':score>=60?'score-good':'score-fair';
  const sl = score>=80?'üî• Top':score>=60?'üëç Good':'üí° Fair';
  const catBadge = {'india_remote':'<span class="badge badge-india">üáÆüá≥ India</span>','sponsorship_worldwide':'<span class="badge badge-sponsor">‚úàÔ∏è Sponsor</span>','remote_worldwide':'<span class="badge badge-remote">üåç Remote</span>'}[job.category]||'';
  const srcBadge = job.source?`<span class="badge badge-source">${job.source.toUpperCase()}</span>`:'';
  const reasons = (job.match_reasons||[]).slice(0,3).map(r=>`<li>‚úÖ ${r}</li>`).join('');
  const missing = (job.missing_skills||[]).slice(0,2).map(m=>`<li>‚ùå ${m}</li>`).join('');
  const title = decodeHTML(job.title||'N/A');
  const company = decodeHTML(job.company||'N/A');
  return `<div class="job-card">
    <div class="card-top">
      <a class="job-title" href="${job.url||'#'}" target="_blank">${title}</a>
      <div class="score-badge ${sc}"><div class="score-num">${score}%</div><div class="score-label">${sl}</div></div>
    </div>
    <div class="company-info">
      <span class="company-name">üè¢ ${company}</span>
      ${job.location?`<span>üìç ${job.location}</span>`:''}
    </div>
    <div class="badges">${catBadge}${srcBadge}</div>
    ${reasons||missing?`<div class="match-section">
      ${reasons?`<div class="match-title">Why You Match</div><ul class="match-list">${reasons}</ul>`:''}
      ${missing?`<div class="match-title" style="margin-top:8px">Skill Gaps</div><ul class="match-list">${missing}</ul>`:''}
    </div>`:''}
    <div class="card-footer">
      <a class="apply-btn" href="${job.url||'#'}" target="_blank">Apply Now ‚Üí</a>
      <button class="save-btn ${isSaved?'saved':''}" onclick="toggleSave('${job.id}',this)">${isSaved?'‚≠ê Saved':'‚òÜ Save'}</button>
    </div>
  </div>`;
}

function toggleSave(id, btn) {
  savedJobs = savedJobs.includes(id) ? savedJobs.filter(x=>x!==id) : [...savedJobs, id];
  btn.textContent = savedJobs.includes(id) ? '‚≠ê Saved' : '‚òÜ Save';
  btn.classList.toggle('saved', savedJobs.includes(id));
  localStorage.setItem('savedQAJobs', JSON.stringify(savedJobs));
  updateSavedPanel();
}

function updateSavedPanel() {
  document.getElementById('saved-count').textContent = savedJobs.length;
  document.getElementById('saved-panel').style.display = savedJobs.length > 0 ? 'block' : 'none';
}

function showSaved() {
  const grid = document.getElementById('jobs-grid');
  const filtered = allJobs.filter(j => savedJobs.includes(j.id));
  grid.innerHTML = filtered.map(buildCard).join('');
  document.getElementById('results-count').textContent = `${filtered.length} saved jobs`;
}

let searchTimer;
document.getElementById('search').addEventListener('input', () => { clearTimeout(searchTimer); searchTimer = setTimeout(renderJobs, 300); });

// ‚îÄ‚îÄ PIN ‚îÄ‚îÄ
const CORRECT_PIN = '9356';
const SESSION_KEY = 'qa_unlocked';
const SESSION_DURATION = 8 * 60 * 60 * 1000;
let pinInput = '';

function checkSession() {
  const ok = sessionStorage.getItem(SESSION_KEY) === 'true';
  const at = parseInt(sessionStorage.getItem(SESSION_KEY+'_at')||'0');
  if (ok && Date.now()-at < SESSION_DURATION) {
    document.getElementById('pin-overlay').style.display = 'none';
    return true;
  }
  return false;
}

function pinPress(d) {
  if (!d || pinInput.length >= 4) return;
  pinInput += d;
  updateDots();
  if (pinInput.length === 4) setTimeout(checkPin, 150);
}

function pinDelete() {
  pinInput = pinInput.slice(0,-1);
  updateDots();
  document.getElementById('pin-error').textContent = '';
  document.querySelectorAll('.pin-dot').forEach(d=>d.classList.remove('error'));
}

function updateDots() {
  for (let i=0;i<4;i++) {
    const d = document.getElementById('dot-'+i);
    d.classList.toggle('filled', i < pinInput.length);
    d.classList.remove('error');
  }
}

function checkPin() {
  if (pinInput === CORRECT_PIN) {
    sessionStorage.setItem(SESSION_KEY,'true');
    sessionStorage.setItem(SESSION_KEY+'_at', Date.now().toString());
    const ov = document.getElementById('pin-overlay');
    ov.style.transition = 'opacity 0.3s';
    ov.style.opacity = '0';
    setTimeout(()=>{ ov.style.display='none'; loadJobs(); }, 300);
  } else {
    document.querySelectorAll('.pin-dot').forEach(d=>d.classList.add('error'));
    document.getElementById('pin-error').textContent = '‚ùå Wrong PIN. Try again.';
    setTimeout(()=>{ pinInput=''; updateDots(); document.getElementById('pin-error').textContent=''; }, 1200);
  }
}

document.addEventListener('keydown', e => {
  if (document.getElementById('pin-overlay').style.display === 'none') return;
  if (e.key >= '0' && e.key <= '9') pinPress(e.key);
  if (e.key === 'Backspace') pinDelete();
});

if (checkSession()) loadJobs();
</script>
</body>
</html>
